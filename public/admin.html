<!doctype html>
<html>
<head><meta charset="utf-8"><title>Admin - Posteos</title></head>
<body style="font-family:Arial;padding:20px;">
  <h2>Panel de Posteos</h2>
  <form id="postForm">
    <div><textarea id="message" rows="4" cols="70" placeholder="Mensaje..."></textarea></div>
    <div>Cron (opcional): <input id="cron" placeholder="ej: 0 10 * * * (todos los días 10:00)"></div>
    <button type="submit">Guardar Post</button>
  </form>
  <hr>
  <h3>Posts guardados</h3>
  <ul id="posts"></ul>

<script>
async function load(){
  const res = await fetch('/api/posts'); const posts = await res.json();
  const ul = document.getElementById('posts'); ul.innerHTML='';
  posts.forEach(p=>{
    const li = document.createElement('li');
    li.innerHTML = `<b>#${p.id}</b> ${p.message} <br> <small>${p.cron_spec||''}</small>
      <br><button onclick="publish(${p.id})">Publicar ahora</button>`;
    ul.appendChild(li);
  });
}
async function publish(id){
  await fetch('/api/publish/'+id,{ method:'POST' });
  alert('Publicado (si el bot está conectado y GROUP_ID ok)');
}
document.getElementById('postForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const message = document.getElementById('message').value;
  const cron_spec = document.getElementById('cron').value || null;
  await fetch('/api/posts', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ message, cron_spec }) });
  document.getElementById('message').value = '';
  document.getElementById('cron').value = '';
  load();
});
load();
</script>
</body>
</html>
